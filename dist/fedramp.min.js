"use strict";!function(){function e(e,n){e.debug("FedRAMP Module Initializing"),n.$on("$stateChangeError",e.debug.bind(e))}angular.module("fedramp",["ui.router","fedramp.models","fedramp.services"]).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|blob|data):/)}]).run(e),e.$inject=["$log","$rootScope"]}(),function(){function e(e){e.debug("fedramp.model module initializing")}angular.module("fedramp.models",[]).run(e),e.$inject=["$log"]}(),function(){function e(e){e.debug("fedramp.services module initializing")}angular.module("fedramp.services",["fedramp.models"]).run(e),e.$inject=["$log"]}(),angular.module("fedramp").run(["$templateCache",function(e){e.put("src/fedramp/fedramp.html",'<header>\n    <div class="usa-grid">\n        <div class="usa-width-one-whole">\n            <!--<img class="header" src="img/fedramp.png"/>-->\n            <h1>FedRAMP</h1>\n        </div>\n    </div>\n\n</header>\n<ui-view></ui-view>\n'),e.put("src/fedramp/home/home.html",'<div class="usa-content">\n    <div class="usa-grid">\n        <div class="usa-width-one-third">\n            <div class="circle">\n                <h4>${{homeController.totalCostSavings()}}</h4>\n                <div>Cost Savings:</div>\n            </div>\n        </div>\n        <div class="usa-width-one-third">\n            <div class="circle">\n                <div>\n                    <h4>{{homeController.totalAuthorized()}}</h4>\n                    Total Authorized:\n                </div>\n            </div>\n        </div>\n        <div class="usa-width-one-third">\n            <div class="circle">\n                <h4>{{homeController.leveragedAtos()}}</h4>\n                <div>Leveraged ATOs:</div>\n            </div>\n        </div>\n    </div>\n    <div style="text-align:center;margin-top:20px;margin-bottom:20px;"> Search by </div>\n    <div ng-show="homeController.hasData()">\n        <div class="filters usa-grid">\n            <div class="usa-width-one-fourth">\n                <button id="filterByCSP"\n                        ng-click="homeController.toggleFilter(\'csp\')">CSP\n                </button>\n            </div>\n            <div class="usa-width-one-fourth">\n                <button id="filterByCSO"\n                        type="radio"\n                        ng-click="homeController.toggleFilter(\'cso\')">CSO\n                </button>\n            </div>\n            <div class="usa-width-one-fourth">\n                <button id="filterByAgency"\n                        ng-click="homeController.toggleFilter(\'agency\')">Agency\n                </button>\n            </div>\n            <div class="usa-width-one-fourth">\n                <button id="filterBy3PAO"\n                        ng-click="homeController.toggleFilter(\'3pao\')">3PAO\n                </button>\n            </div>\n        </div>\n        <div class="usa-grid" ng-show="!!homeController.filterType">\n            <div style="text-align:center;" class="usa-width-one-whole">\n                <div style="margin:0 auto;display:table;">\n                    <label for="filter">Filter using:</label>\n                    <select id="filter"\n                            ng-model="homeController.filter"\n                            ng-options="option for option in homeController.filterOptions"\n                            ng-change="homeController.applyFilter()">\n                        <option value=""></option>\n                    </select>\n                </div>\n                <a href="{{homeController.downloadUrl}}"\n                   download="{{homeController.filename()}}"\n                   ng-click="homeController.download()">\n                    Download\n                </a>\n            </div>\n        </div>\n    </div>\n</div>\n')}]),function(){function e(e,n){function t(e){return e.pull().then(function(e){return e})}n.otherwise("/"),e.state("fedramp",{"abstract":!0,templateUrl:"src/fedramp/fedramp.html",resolve:{providers:t}}).state("fedramp.home",{url:"/",templateUrl:"src/fedramp/home/home.html",controller:"HomeController as homeController"}),t.$inject=["ProviderService"]}angular.module("fedramp").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){function e(){return n}function n(e){var n=this,t={Letter_Date:"letterDate",Letter_Expiration_Date:"letterExpirationDate",Authorization_Date:"authorizationDate",Authorizing_Letter_Last_Sign_Date:"authorizingLetterSignedDate",Authorizing_Agency:"authorizingAgency",Authorizing_Subagency:"authorizingSubagency",Active:"active",Include_In_Marketplace:"includeInMarketplace",Independent_Assessor:"independentAssessor"};return n.letterDate=null,n.letterExpirationDate=null,n.authorizationDate=null,n.authorizingLetterSignedDate=null,n.authorizingAgency="",n.authorizingSubagency="",n.active="",n.includeInMarketplace="",n.independentAssessor="",n.init=function(e){if(!e)return n;for(var r in e)if(e.hasOwnProperty(r)){var o=t[r];o?n[o]=e[r]:n.hasOwnProperty(r)&&(n[r]=e[r])}return n},n.init(e)}angular.module("fedramp.models").factory("AtoLetter",e)}(),function(){function e(e){function n(n){var t=this,r={Cloud_Service_Provider_Name:"name",Cloud_Service_Provider_Package:"pkg",Path:"path",Designation:"designation",Package_ID:"pkgId",Service_Model:"serviceModel",Deployment_Model:"deploymentModel",Impact_Level:"impactLevel",Original_Authorization_Date:"authorizationDate",Original_Expiration_Date:"expirationDate",Sponsoring_Agency:"sponsoringAgency",Sponsoring_Subagency:"sponsoringSubagency",Active:"active",CSP_URL:"cspUrl",Underlying_CSP_Package_ID:"underlyingCspPackages",Stage:"stage",Independent_Assessor:"independentAssessor",Leveraged_ATO_Letters:"atoLetters"};return t.name="",t.pkg="",t.pkgId="",t.path="",t.designation="",t.serviceModel=[],t.deploymentModel="",t.impactLevel="",t.authorizationDate=null,t.expirationDate=null,t.sponsoringAgency="",t.sponsoringSubagency="",t.active="",t.cspUrl="",t.underlyingCspPackages=[],t.stage="",t.independentAssessor="",t.atoLetters=[],t.init=function(n){if(n){for(var o in n)if(n.hasOwnProperty(o)){var a=r[o];if(a)if("atoLetters"===a)for(var i=0;i<n[o].length;i++)t[a].push(new e(n[o][i]));else t[a]=n[o];else if(t.hasOwnProperty(o))if("atoLetters"===o)for(var s=0;s<n[o].length;s++)t[o].push(new e(n[o][s]));else t[o]=n[o]}return t}},t.hash=function(){var e=""+t.name+t.pkg+t.pkgId+t.sponsoringAgency;return 0===e.length?null:e},t.init(n)}return n}angular.module("fedramp.models").factory("Provider",e),e.$inject=["AtoLetter"]}(),function(){function e(){return n}function n(e){function n(){var e=new Date,n=e.getDate(),t=e.getMonth()+1,r=e.getFullYear();return n<10&&(n="0"+n),t<10&&(t="0"+t),t+"/"+n+"/"+r}var t=this;return t.lastRefresh=null,t.init=function(e){if(e)for(var n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&(t[n]=e[n]);return t},t.refresh=function(){return t.lastRefresh=n(),t.lastRefresh},t.clearRefresh=function(){t.lastRefresh=null},t.needsRefresh=function(){return t.lastRefresh!==n()},t.init(e)}angular.module("fedramp.services").factory("Settings",e)}(),function(){function e(e){function n(e,n){return Papa.unparse(e,n)}function t(e){for(var n=[],t=0;t<e.length;t++){var a=e[t],i=r(a),s=e[t].atoLetters;if(s&&0!==s.length)for(var l=0;l<e[t].atoLetters.length;l++){var u=angular.copy(i),c=e[t].atoLetters[l],d=o(c);u=angular.extend(u,d),n.push(u)}else n.push(i)}return n}function r(e){return{"Cloud Service Provider Name":e.name,Designation:e.designation,"Service Model":e.serviceModel.join(","),"Deployment Model":e.deploymentModel,"Impact Level":e.impactLevel,Sponsoring_Agency:e.sponsoringAgency,Sponsoring_Subagency:e.sponsoringSubagency}}function o(e){return{"Letter Date":e.letterDate,"Letter Expiration Date":e.letterExpirationDate,"Authorization Date":e.authorizationDate,"Authorizing Letter Signed Date":e.authorizingLetterSignedDate,"Authorizing Agency":e.authorizingAgency,"Authorizing Subagency":e.authorizingSubagency,"Letter Active":e.active,"Include In Marketplace":e.includeInMarketplace}}var a=this;a.flattenProviders=t,a.toCsv=n}angular.module("fedramp.services").service("CsvService",e),e.$inject=["$log"]}(),function(){function e(e){var n=this;n.pull=function(n){return e.get(n).then(function(e){return e.data})}}angular.module("fedramp.services").service("DatasourceService",e),e.$inject=["$http"]}(),function(){function e(e,n,t,r,o){var a=this,i="https://raw.githubusercontent.com/18F/fedramp-micropurchase/master/data/data.json";a.pull=function(){return o.pull(i).then(function(e){for(var n=(e.meta,e.data),o=new t,a=0;a<n.length;a++){var i=new r(n[a]);o.update(i.hash(),i)}return o.all()})}}angular.module("fedramp.services").service("ProviderService",e),e.$inject=["$log","StorageManager","StorageProvider","Provider","DatasourceService"]}(),function(){function e(){return n}function n(e){function n(){return"undefined"==typeof Storage?"Local storage is not supported":null}function t(){var e=[],n=JSON.parse(localStorage.getItem(i.storageContainer));if(n)for(var t in n)e.push(i.transform(n[t]));return e}function r(e){var n=JSON.parse(localStorage.getItem(i.storageContainer));return n&&n[e]?i.transform(n[e]):null}function o(e,n){var t=JSON.parse(localStorage.getItem(i.storageContainer));t||(t={}),e&&(t[e]=n,i.transform(t[e]),localStorage.setItem(i.storageContainer,JSON.stringify(t)))}function a(){localStorage.getItem(i.storageContainer)&&localStorage.removeItem(i.storageContainer)}var i=this;return i.storageContainer="default",i.init=function(e){var t=n();if(t&&0!==t.length)throw t;return e&&e.storageContainer&&(i.storageContainer=e.storageContainer),i},i.update=function(e,n){o(e,n)},i.byId=function(e){return r(e)},i.clear=function(){a()},i.all=function(){return t()},i.transform=function(e){return e},i.init(e)}angular.module("fedramp.services").factory("StorageManager",e)}(),function(){function e(e,n){function t(t){e.call(this);var r=this;return r.storageContainer="providers",r.transform=function(e){return new n(e)},r.init(t)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}angular.module("fedramp.services").factory("StorageProvider",e),e.$inject=["StorageManager","Provider"]}(),function(){function e(e,n){function t(t){e.call(this);var r=this;return r.storageContainer="fedramp",r.transform=function(e){return new n(e)},r.init(t)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}angular.module("fedramp.services").factory("StorageSettings",e),e.$inject=["StorageManager","Settings"]}(),function(){function e(e,n,t){function r(){o.sortBy&&0!==o.sortBy.length&&(o.filteredData=o.filteredData.sort(function(e,n){return e[o.sortBy]===n[o.sortBy]?0:o.sortAscending?e[o.sortBy]<n[o.sortBy]?-1:1:e[o.sortBy]>n[o.sortBy]?-1:1}))}var o=this,a="",i=null;o.title="FedRAMP",o.downloadUrl="#",o.sortBy="name",o.sortAscending=!0,o.filteredData=[],o.filterType="",o.filterOptions=[],o.filter="",o.hasData=function(){return n&&n.length>0},o.applyFilter=function(e,a){if(e=e?e:o.filterType,a=a?a:o.filter,!e||!a)return o.filteredData=n,void r();var s=[];switch(e){case"csp":for(var l=0;l<n.length;l++){var u=n[l];u.name.indexOf(a)!==-1&&s.push(u)}break;case"cso":for(var c=0;c<n.length;c++){var d=n[c];d.pkg.indexOf(a)!==-1&&s.push(d)}break;case"agency":for(var g=0;g<n.length;g++){var f=n[g];if((f.sponsoringAgency+f.sponsoringSubagency).indexOf(a)!==-1)s.push(f);else for(var p=0;p<f.atoLetters.length;p++){var h=f.atoLetters[p];if((h.authorizingAgency+h.authorizingSubagency).indexOf(a)!==-1){s.push(f);break}}}break;case"3pao":for(var v=0;v<n.length;v++){var m=n[v];m.independentAssessor.indexOf(a)!==-1&&s.push(m);for(var y=0;y<m.atoLetters.length;y++){var S=m.atoLetters[y];if(S.independentAssessor.indexOf(a)!==-1){s.push(m);break}}}}o.filteredData=s,r(),o.downloadUrl="#",i=null;var A=t.toCsv(t.flattenProviders(s));A&&(i=new Blob([A],{type:"text/csv;charset=utf-8;"}),o.downloadUrl=window.URL.createObjectURL(i))},o.toggleFilter=function(e){if(o.filterType=e,a===e)return void(o.filterType="");a=e;var t=[];switch(e){case"csp":for(var r=0;r<n.length;r++){var i=n[r];i.name&&!t.includes(i.name)&&t.push(i.name)}break;case"cso":for(var s=0;s<n.length;s++){var l=n[s];l.pkg&&!t.includes(l.pkg)&&t.push(l.pkg)}break;case"agency":for(var u=0;u<n.length;u++){var c=n[u];c.sponsoringAgency&&!t.includes(c.sponsoringAgency)&&t.push(c.sponsoringAgency),c.sponsoringSubagency&&!t.includes(c.sponsoringSubagency)&&t.push(c.sponsoringSubagency);for(var d=0;d<c.atoLetters.length;d++){var g=c.atoLetters[d];g.authorizingAgency&&!t.includes(g.authorizingAgency)&&t.push(g.authorizingAgency),g.authorizingSubagency&&!t.includes(g.authorizingSubagency)&&t.push(g.authorizingSubagency)}}break;case"3pao":for(var f=0;f<n.length;f++){var p=n[f];p.independentAssessor&&!t.includes(p.independentAssessor)&&t.push(p.independentAssessor);for(var h=0;h<p.atoLetters.length;h++){var v=p.atoLetters[h];v.independentAssessor&&!t.includes(v.independentAssessor)&&t.push(v.independentAssessor)}}}o.filterOptions=t},o.download=function(){e.info("Download clicked"),navigator.msSaveBlob&&i&&navigator.msSaveBlob(i,o.filename())},o.filename=function(e){e||(e=new Date);var n=e.getDate(),t=e.getMonth()+1,r=e.getFullYear();return n<10&&(n="0"+n),t<10&&(t="0"+t),"fedramp-"+r+"-"+t+"-"+n+".csv"},o.totalAuthorized=function(){for(var e=0,t=[],r=0;r<n.length;r++){var o=n[r];o.name&&!t.includes(o.name)&&(t.push(o.name),e++)}return e},o.totalCostSavings=function(){return Number(25e4*o.leveragedAtos()).toLocaleString("en")},o.leveragedAtos=function(){var e=0;return n.forEach(function(t){e+=o.calcCSPReuse(t,n,!1)}),e},o.calcCSPReuse=function(e,n,t){var r=e.atoLetters.length,o=n.filter(function(n){if(n.underlyingCspPackages)return n.underlyingCspPackages.includes(e.pkgId)}),a=o.length;return o.length>0&&(a+=o.map(function(e){return e.atoLetters.length}).reduce(function(e,n){return e+n})),r+a}}angular.module("fedramp").controller("HomeController",e),e.$inject=["$log","providers","CsvService"]}();