language: node_js
node_js:
- '6'
# Fixes issues on dependeny Karma>Chokidar>fsevents. See more here: https://github.com/travis-ci/travis-ci/issues/4653
before_install:
- npm update -g npm
before_deploy:
- export PATH=$HOME:$PATH
- travis_retry curl -L -o $HOME/cf.tgz "https://cli.run.pivotal.io/stable?release=linux64-binary&version=6.15.0"
- tar xzvf $HOME/cf.tgz -C $HOME
- cf install-plugin autopilot -f -r CF-Community
- npm run package
env:
  global:
  - CF_USERNAME_DEV=cd10c403-067d-429e-8670-f0f383e5145f
  - secure: "jurfos1laFOnDwoplV0O1Yq78PT14zxxfgQlzkgdWi/mLG2HQHJu1B97AhY+D8ijPzODJQAyq3DkSBdscD2KLDDK0Eb7hfNXzhFzbw+VfaCg0BweWdr10dCNwfhlc0TtXCVFi5T/fd8HtDLuY/2YJx8tEyua6yRkd81Hiatr5PwuZmeTDXLpizlAKsUmHEYVQsJukysRhY2TLzoH2PQYMHz5xRzWZFXEZy9dsAvkZF4ey/wjaFYXA7xU3xypBi9yKxhegzu9102abwJTFndMZ9YSrWuoSyxV28k57vObGQMa5FCJ9ByIDeRdD6AjODqCtsyLwLFkh4889pao7k+7OGT3PF6k3I2/a8DhsBvijhAg9Kj6o6zrKmjSO0KIKUb1l8kiW7+zU+LDV2BDkdWJdzbaxPqxA7ns8ey/GYrTxC9nbXEihuv1k8XaG3s9iSolbPcrHX/BvSFs2jxarQZ3ptbk/csRH/hYbXgs+KBKRaSJXZY4gNUPjSQu+SUWgEj4jvX/JqoI1wgbcXXwP60dnkMYxJr3mX+KmGUTw+bQg8r/PLdzA4xqp2O4IVeOdncwXWxoC6xxfHACWtj0m/w5UNGBfBeECxgN7A/R1krs6VyRBQAtx41Km9NqOCbrd9mBEzO03X2x6e6rnmpxsOEhT3BTIxg+ZkJJbWNRlk6ekz0="
  - CF_USERNAME_PROD=408ccc13-d8ea-4a23-8251-33a00837f761
  - secure: "SHYRQYvmHWAEP7NuxGl5wSN/dAX8sHENFT0PBRznNiVEsrMCjY6i5CtywthPRjCbXv/ANikepjJSSmELUU8vumAFdYDE/T+qVq5BdockzdB36fRrQwN8f1W3y38UTGlFLKIdVrzV+VPIhs76cCNhIjbsyZDRi8smqVXHRp3vkdjq4PKsmQq/YHOc1ADBnrN1FcB/zzWfipsH9HgnjgIF4DDkI/UNG6f5hPh5ec942B2Oh3wddeB7R0qOd10GIWNIpix8ipMKRJomSzA5fcqAAFGtG0mDVXO9y7iV9e0552ij+AaTL0dPDHMD9cYyaMYVtVOY1VT46vlX5LoK4Y2XevMTUHKny11W51lAvsgSvNZAL+iihHcDW6BCEQ5+5nlUayBCEqO6YRpLY+Au3PmaUY90GcHxgUm0bR50EYLkfaqj+MCEK19naggfZAmhd0huzo0GDJRqPRDqMJIuC5Hr/QA+WRjbp45cyRQxwGDGJgrDkT/aaghj+2YDPEryETwfDncY1uEb4Ky+dPP3bcmtJDFrqvZuPJe3CYD+oQR4fs8cYR5GuSoX3co2YT3uhK7n4RkW+LEv556V/eoF6WhywMGSyVebUtwl+RBrISslhEFXX7HaFAW/qOkgbq7Ho5IZDlVHP/etYsip/rwxSGGYPVMP+dxwrZzwgsNttlI7Qlg="
deploy:
  - provider: script
    script: "./bin/deploy.sh develop"
    skip_cleanup: true
    on:
      branch: develop
      repo: 18F/fedramp-dashboard
  - provider: script
    script: "./bin/deploy.sh prod"
    skip_cleanup: true
    on:
      branch: master
      repo: 18F/fedramp-dashboard
after_script:
- npm install -g pa11y-crawl
- pa11y-crawl --run "./node_modules/.bin/http-server dist" --ci http://localhost:8080
